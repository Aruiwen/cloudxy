#summary 介绍EMCS开发调试介绍.


==获取EMCS代码==
svn co http://cloudxy.googlecode.com/svn/trunk/ECMS

==编译==
# 首先需要下载erlang —— 建议使用最新OTP R15B的版本
# 进入CloudMaster目录;执行erl -make — 编译cloudMaster Application
# 进入NodeController目录;执行erl -make — 编译NodeController Application

==启动node==
 *启动node 运行cloud master
   # 进入CloudMaster目录
   # erl -name node_master@127.0.0.1 -setcookie abc -boot start_sasl -pa ebin
 *启动node 运行node controller
   # 进入nodeController目录
   # erl -name node_controller1@127.0.0.1 -setcookie abc -boot start_sasl -pa ebin
{{{ 
注意:
1. node 的cookie需要设置为一样,否则无法交流.
2. 我们假设的部署方式是:node controller一个宿主机只部署一个.
}}}

==初始化CloudMaster==
 * 启动cloud_master — 在node shell 上启动cloud_master application :(node1@127.0.0.1)1>application:start(cloud_master).
   
{{{ 
注：
1.系统启动自动初始化运行环境——包含各种元数据表等.如果启动后看到屏幕有输出
   =PROGRESS REPORT==== 23-Jan-2012::14:51:45 ===
         application: cloud_master
          started_at: 'node1@127.0.0.1'
   则表示启动成功。
2.为保证数据安全，数据表将配置在多个node机器上，这些副本所在node将在sys.config配置（meta_nodes），测试期间未有sys.config文件情况下，将默认在本机node上建立数据表。
3.tv:start().可观察到系统建立了我们建立了6张元数据表——其中sequence表用于产生序列号，其余表用于元数据存储。
4.appmon:start(). 可观察系统各组件运行状况
}}}
 * 导入网络资源 — 在node shell上执行meta_data_ops:add_netaddr_res（IPaddr） 如 meta_data_ops:add_netaddr_res("192.168.0.99").
{{{
注
网络ip地址资源用于分配给各虚拟机,为了简单和部署灵活起见,我们目前采用手动导入的方式初始化IP地址资源——mac等则自动产生.注意该动作只用做一次
}}}

==加入node到集群中==
 * 为了从master所在shell执行命令，需要加入对应的record(因为我们命令使用了record描述)—shell中执行 rr("include/*.hrl")
 * 动态增增加节点—  gen_server:call(meta_server,#add_node_2m_req{node_name="node_controller1@127.0.0.1"},2000).
{{{
注：
1.注意是从master所在shell执行。
2.如果你手头没有合适虚拟机环境，也可以进行调试。只需要将node controller/src/command的各命令中增加-define(MOCK_TEST,1)，则可进行模拟调试调度框架.
}}}

==创建虚拟机==
 * 执行gen_server:call(meta_server,  #vm_create_2m_req{vm_resource_info=#machine_resoure_info_t{mem_size=256,cpu_count=1,disk_size=0},vm_custom_info=#vm_custom_info_t{user_password="xxx",user_hostname="yyy"},os_type=ubuntu},2000)
{{{
注.
1.上述命令返回一个VM_ID序列号表示创建的VM，以后对该VM操作都将传入该ID.
2.tv:start()检测你可发现vm_resource_config表中已经创建了一个上述VM_ID为主键的记录，不过记录中网络地址并给定——因为只有到实际启动后才真正分配固定的IP给你.
3.目前我们实现中系统盘的disk_size并未使用，系统盘创建大小目前固定给出.
}}}

==启动虚拟机==
 * 执行gen_server:call(meta_server, #vm_start_2m_req{vm_id=1},2000)

---------------------
wroten by 康华